<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="md.css" type="text/css">

<title>3. Surface Data Mapping</title>

</head>
<body>
<blockquote><p><a href=/gempak/tutorial/>GEMPAK Online Tutorial</a></p></blockquote>

<h1>3. Surface Data Mapping</h1>

<p>The program <code>sfmap</code> plots any parameters which can be derived from the data in a GEMPAK surface data file.</p>

<p><a name="3.1"></a></p>

<h2>SFMAP Input Parameters</h2>

<pre>
<a href=/gempak/man/parm/area.html>AREA</a>      Data area
<a href=/gempak/man/parm/garea.html>GAREA</a>     Graphics area
<a href=/gempak/man/parm/satfil.html>SATFIL</a>    Satellite image filename(s)
<a href=/gempak/man/parm/radfil.html>RADFIL</a>    Radar image filename(s)
<a href=/gempak/man/parm/imcbar.html>IMCBAR</a>    Color/ornt/anch/x;y/ln;wd/freq
<a href=/gempak/man/parm/sfparm.html>SFPARM</a>    Surface parameter list
<a href=/gempak/man/parm/dattim.html>DATTIM</a>    Date/time
<a href=/gempak/man/parm/sffile.html>SFFILE</a>    Surface data file
<a href=/gempak/man/parm/colors.html>COLORS</a>    Color list
<a href=/gempak/man/parm/map.html>MAP</a>       Map color/dash/width/filter flag
<a href=/gempak/man/parm/mscale.html>MSCALE</a>    fgc;bgc;mask/units/lat;hide/values/anch/x;y/ln;wd/freq|text_info|t
<a href=/gempak/man/parm/latlon.html>LATLON</a>    Line color/dash/width/freq/inc/label/format
<a href=/gempak/man/parm/title.html>TITLE</a>     Title color/line/title
<a href=/gempak/man/parm/clear.html>CLEAR</a>     Clear screen flag
<a href=/gempak/man/parm/panel.html>PANEL</a>     Panel loc/color/dash/width/regn
<a href=/gempak/man/parm/device.html>DEVICE</a>    Device|name|x size;y size|color type
<a href=/gempak/man/parm/proj.html>PROJ</a>      Map projection/angles/margins|drop flag
<a href=/gempak/man/parm/filter.html>FILTER</a>    Filter data factor
<a href=/gempak/man/parm/text.html>TEXT</a>      Size/fnt/wdth/brdr/N-rot/just/hw flg
<a href=/gempak/man/parm/lutfil.html>LUTFIL</a>    Enhancement lookup table filename
<a href=/gempak/man/parm/stnplt.html>STNPLT</a>    Txtc/txt attr|marker attr|stnfil#col
<a href=/gempak/man/parm/clrbar.html>CLRBAR</a>    Color/ornt/anch/x;y/ln;wd/freq|text_info
<a href=/gempak/man/parm/lstprm.html>LSTPRM</a>    Filtered parm|x;y|TEXT info
</pre>


<p>To list the variable definitions in the same format as they are entered, type <code>list</code> or <code>l</code> for short:</p>

<pre><code> GEMPAK-SFMAP&gt;l
 AREA     = WV
 GAREA    = WV
 SATFIL   =
 RADFIL   =
 IMCBAR   =
 SFPARM   = SKYC;TMPF;WSYM;PMSL;;DWPF;BRBK
 DATTIM   = LAST
 SFFILE   = $GEMPAK/data/hrcbob.sfc
 COLORS   = 1
 MAP      = 1
 MSCALE   = 0
 LATLON   =
 TITLE    = 1
 CLEAR    = YES
 PANEL    = 0
 DEVICE   = XW
 PROJ     = MER
 FILTER   = YES
 TEXT     = 1
 LUTFIL   =
 STNPLT   =
 CLRBAR   =
 LSTPRM   =
 GEMPAK-SFMAP&gt;
</code></pre>

<p>What are looking at? <strong>hrcbob.sfc</strong>? <strong>WV</strong>?</p>

<p>These are the program defaults and allow us to list and plot data immediately when starting to use GEMPAK.</p>

<p>Run <code>sfmap</code> now:</p>

<pre><code>GEMPAK-SFMAP&gt;r
Creating process: xw for queue 9797635
SFMAP PARAMETERS:

Data area:          WV
Graphics area name: WV
Valid parameters:    SKYC TMPF WSYM PMSL BLNK DWPF BRBK
Parameter colors:     1    1    1    1    0    1    1
Time:              910820/0600
File:              $GEMPAK/data/hrcbob.sfc
Map:               1
Title:             1
Device:            XW
Projection:        MER
Clear screen:      YES
Filter:            YES
Filter factor:      1.00
Panel:             0 
Enter &lt;cr&gt; to accept parameters or type EXIT:
</code></pre>

<p>Press <enter> once more to display the map:</p>

<p><img src="sfmap.gif" alt="image" /></p>

<p>The X window will display surface observations from "Hurricane Bob" in 1991, centered around West Virginia.</p>

<p><a name="3.2"></a></p>

<h2>Adjusting AREA and GAREA</h2>

<p><code>GAREA</code> is the graphics area: the part of the map that will be plotted. <code>AREA</code> is the data area: the area from which to select the data to plot. These areas exist separately for when you might want individual control over both the region of the map that is plotted (<code>GAREA</code>) and the region that is covered by data (<code>AREA</code>).</p>

<p> Both are defined by the same syntax (below), but can be defined a number of different ways:</p>

<ol>
<li><p><strong>Lat/Lon</strong></p>

<pre><code> AREA = 25;-125;50;-65        
</code></pre>

<p> defines the corners <code>Lat 1; Lon 1; Lat 2; Lon 2</code> of the form <code>LL (1); UR (2)</code>.</p>

<p> <img src=warning.gif width=30> Be aware that South and West are negative!</p></li>
<li><p><strong>Center/Offset</strong></p>

<pre><code> AREA = #37.5;-95;12.5;30       
</code></pre>

<p> In the form <code>#Center lat; Center lon; Delta lat; Delta lon</code></p></li>
<li><p><strong>Geographic Area</strong> (defined in the GEMPAK geography table <code>$GEMTBL/stns/geog.tbl</code>)</p>

<pre><code> AREA = US      the region around the United States.  
 AREA = MX      the region around Mexico      
 AREA = CO      the region around Colorado.
 AREA = @CO     only information inside Colorado.
 AREA = @AU:C   Australia (use :C syntac for countries
                  other than US, CN and MX)
</code></pre></li>
<li><p><strong>Station Area and Station Name</strong></p>

<pre><code> AREA = LAX     the region around Los Angelos
 AREA = @DEN    only information from the Denver station
 AREA = @DEN;LAX;PDX
                 only Denver, LA and Portland stations
</code></pre></li>
<li><p><strong>Full Data Set</strong> (all stations in the file)</p>

<pre><code> AREA = DSET     
</code></pre></li>
<li><p><strong>Contracted and Expanded Areas </strong></p>

<pre><code> AREA = CO+      AREA is contracted around CO
 AREA = CO++     AREA is contracted further around CO
 AREA = CO-      AREA is expanded beyond CO
 AREA = @CO--    AREA is expanded even more, but only includes
                  information inside Colorado
</code></pre></li>
<li><p><strong>Integer Value </strong>(stations are selected if they fall into the range indicated)</p>

<pre><code> AREA = SELV:0:2000   Selects stations with elevations
                      between 0 and 2000 meters                    
 AREA = SLAT:-45:45   Selects stations located between 45 
                      degrees south and 45 north           
 AREA = SLON:-45:45   Between 45 west and 45 east
</code></pre></li>
</ol>


<p>Any station information can be used in this way:</p>

<ul>
<li><code>STID</code> (Station ID-letters)</li>
<li><code>STNM</code> (Station Number)</li>
<li><code>SLAT</code> (Station Lat)</li>
<li><code>SLON</code> (Station Lon)</li>
<li><code>STIM</code> (Station Report Time)</li>
</ul>


<blockquote><p><img src=tip.gif width=40 align=left> If you want to plot a map with complete  data coverage, including the edges, you should make <code>AREA</code> bigger than <code>GAREA</code>. This can be done by adding a minus <code>-</code> to <code>AREA</code> or a plus <code>+</code> to <code>GAREA</code>:</p>

<pre><code>    GEMPAK-SFMAP&gt; area = wv-
    GEMPAK-SFMAP&gt; garea = wv
    GEMPAK-SFMAP&gt; r
</code></pre></blockquote>

<p><img src=warning.gif width=30 align=left> <strong>MAKE NOTE</strong> <code>GAREA</code> can be specified in some of the same ways as <code>AREA</code>, with one caveat: <strong>You can not use the <code>@</code> symbol to specify <code>GAREA</code></strong>.</p>

<p>Because <code>GAREA</code> defines the boundaries of the graph, adding <code>@</code> would force an irregular boundary. Think of the @ sign as a way to restrict the selection of data.</p>

<p><a name="3.3"></a></p>

<h2>SFPARM Surface Parameters</h2>

<p>Multiple surface parameters may be defined in <code>SFPARM</code> by entering a list separated by semicolons:</p>

<pre><code>sfparm = tmpc;pmsl;skyc
</code></pre>

<p>GEMPAK can also calculate a number of parameters if the requested parameter is not present in the data set, for example, such as with relative humidity, which GEMPAK determines from a function defined
internally as <code>RELH=FUNC (TMPC;DWPT)</code>.</p>

<pre><code>sfparm = RELH 
</code></pre>

<p>Arithmetic functions and upper and lower limits may be used in the paramater definition:</p>

<pre><code>sfparm = tmpc/2    
sfparm = pmsl&gt;1000      
</code></pre>

<p>where <code>pmsl&gt;1000</code> restricts sea-level pressure records to those below 1000 mb,</p>

<p>You can manipulate the values of parameters using the following arithmetic functions:</p>

<ul>
<li>Multiplivcation <code>*</code></li>
<li>Division <code>/</code></li>
<li>Addition <code>+</code></li>
<li>Subtraction <code>-</code></li>
<li>Greater than <code>&gt;</code></li>
<li>Less than <code>&lt;</code></li>
</ul>


<p>Raw hourly and special reports (if stored in a file) can be accessed as well:</p>

<pre><code>sfparm = text
sfparm = spcl
sfparm = text;spcl
sfparm = pmsl;tmpc;wthr;text
</code></pre>

<p>For now, to continue with our <code>SFMAP</code> example, set <code>sfparm</code> back to:</p>

<pre><code>sfparm = SKYC;TMPF;WSYM;PMSL;;DWPF;BRBK
</code></pre>

<p><a name="3.4"></a></p>

<h2>Date and Time</h2>

<p><code>DATTIM</code> is date and time, formatted in a number of ways:</p>

<ol>
<li><p>Explicit, for all observations at time YYMMDD/HHMM:</p>

<pre><code> DATTIM = 101025/1200        
</code></pre></li>
<li><p>Abbreviation, for the last available date and/or time specified:</p>

<pre><code> DATTIM = 25/1200      DD/HHMM        
 DATTIM = 25/12        DD/HH    
 DATTIM = /1200        /HHMM
 DATTIM = 12           HH
</code></pre></li>
<li><p>Range, for all observations between the two date/time ranges:</p>

<pre><code> DATTIM = 17/00-17/1200
</code></pre></li>
<li><p>List, for all available observations that match the exact date/times listed:</p>

<pre><code> DATTIM = 17/00;17/06;17/12   
</code></pre></li>
<li><p>List, for all times in the file, useful for when you don`t know the times when the
data was collected:</p>

<pre><code>  DATTIM = list     
</code></pre></li>
<li><p>Last, for observations from the last date/time in the file:</p>

<pre><code> DATTIM = last                 
</code></pre></li>
<li><p>All, for observations from every date/time in the file, useful for comprehensive analyses:</p>

<pre><code> DATTIM = all
</code></pre></li>
</ol>


<p>What happens when we change <code>DATTIM = all</code> for <code>sfmap</code>:</p>

<p><img src="sfmap4.gif" alt="image" /></p>

<blockquote><p><img src=tip.gif width=40 align=left> If  <code>DEVICE = xw</code> you should
see an animation through all times in the file.  If <code>DEVICE = gif</code> you'll see stations
plotted multiple times to the map if <code>CLEAR = no</code> is defined.</p></blockquote>

<p><a name="3.5"></a></p>

<h2>Clearing the Map Window</h2>

<p><code>CLEAR</code> is a logical variable which determines whether the graphics screen is cleared before plotting.</p>

<ol>
<li><code>CLEAR = YES</code> (or <code>CLEAR = y</code> for short) will clear the window of all previously-drawn graphics before plotting what has been specified.</li>
<li><code>CLEAR = NO</code> (or <code>CLEAR = n</code>) will draw what is currently specified over any previously-drawn graphics.</li>
</ol>


<p>With <code>CLEAR = n</code>, you have the ability to overlay observations, images, maps and various vector and scalar quantities, depending on the GEMPAK program being used.  Additionally, because GEMPAK mapping programs operate within one <code>gplt</code> process (until <code>gpend</code> is called from the command line), you can overlay fields on the same map projection using multiple programs!</p>

<p><a name="3.6"></a></p>

<h2>Map Projections</h2>

<p><code>PROJ</code> determines the map projection, and directly affects the way the map looks on the screen.  <code>PROJ</code> and <code>GAREA</code> together give you the flexibility to generate very specific map projections.  Both  <strong>simple map projections</strong> and <strong>full map projections</strong> are avaiable to select:</p>

<ol>
<li><p><strong>Simple Map Projections</strong></p>

<p> Simple map projections only require the three-character identifier to be defined:</p>

<pre><code> proj = mer
</code></pre>

<p> Available simple map projections:</p>

<pre><code> MER     Mercator
 NPS     North Polar Stereographic
 SPS     South Polar Stereographic
 LCC     Northern Hemisphere Lambert Conic Conformal
 SCC     Southern Hemisphere Lambert Conic Conformal
 CED     Cylindrical Equidistant
 MCD     Modified Cylindrical Equidistant
 UTM     Universal Transverse Mercator
 NOR     North Orthographic 
 SOR     South Orthographic 
</code></pre></li>
<li><p><strong>Full Map Projections</strong></p>

<p> For full map projections, each definition <strong>MUST</strong> be followed by three specified angles based on the projection class (CYL,AZM, CON), which are defined like so:</p>

<pre><code> proj = STR/a1;a2;a3
 proj = STR/90;-100;0
</code></pre>

 Where

<ul>
<li><code>a1</code> (90) is the standard latitude through which the projection plane passes</li>
<li><code>a2</code> (-100) is the central longitude (i.e. the longitude that lies parallel to the    grid columns).</li>
<li><code>a3</code> (0) angle to skew the projection, defined as zero for these examples.</li>
</ul>


<p> You can read about these angles and projections in more detail on the <a href=/gempak/man/parm/proj><code>PROJ</code> parameter page</a>.</p>

<p> Available full map projections:</p>

<pre><code> MER (CYL)   Mercator
 CED (CYL)   Cylindrical Equidistant
 MCD (CYL)   Modified Cylindrical Equidistant
 STR (AZM)   Polar Stereographic
 AED (AZM)   Azimuthal Equidistant
 ORT (AZM)   Orthographic
 LEA (AZM)   Lambert equal area
 GNO (AZM)   Gnomonic
 LCC (CON)   Northern Hemisphere Lambert Conic Conformal
 SCC (CON)   Southern Hemisphere Lambert Conic Conformal
</code></pre></li>
</ol>


<p><a name="3.7"></a></p>

<h2>Exercise #2 (Overlay Satellite Image)</h2>

<p>Display the visible satellite image from 18Z and overlay the surface data
for the area covered by the image. Plot a standard station model for each location in the data set. The surface data to plot include:</p>

<ol>
<li><font color=#00b0e8>sky cover symbol</font></li>
<li><font color=#f80000>temperature in Fahrenheit</font></li>
<li><font color=#f800f8>weather symbol</font></li>
<li><font color=#1890f8>coded mean sea level pressure</font></li>
<li><font color=#e8e800>pressure tendency with symbol</font></li>
<li><font color=#00c800>dewpoint in Fahrenheit</font></li>
<li><font color=#c88000>station ID</font></li>
<li><font color=#00f8f8>wind barbs in knots</font></li>
</ol>


<p>Therefore, the surface parameters used would be</p>

<p><tt>
SFPARM   =  <font color=#00b0e8>skyc</font>; <font color=#f80000>tmpf</font>; <font color=#f800f8>wsym</font>; <font color=#1890f8>smsl</font>; <font color=#e8e800>ptnd</font>; <font color=#00c800>dwpf</font>; <font color=#c88000>stid</font>;; <font color=#00f8f8>brbk</font>
</tt></p>

<p>and colors</p>

<p><tt>
COLORS   =  <font color=#00b0e8>26</font>; <font color=#f80000>2</font>; <font color=#f800f8>7</font>; <font color=#1890f8>25</font>; <font color=#e8e800>20</font>; <font color=#00c800>22</font>; <font color=#c88000>18</font>; <font color=#00f8f8>6</font>
</tt></p>

<pre><code>    AREA     =  us
    GAREA    =  dset
    SATFIL   =  $GEMPAK/data/VIS_910819_1801
    RADFIL   =  
    IMCBAR   =  
    SFPARM   =  skyc;tmpf;wsym;smsl;ptnd;dwpf;stid;;;brbk
    DATTIM   =  910819/1800
    SFFILE   =  $GEMPAK/data/hrcbob.sfc
    COLORS   =  26;2;7;25;20;22;18;6
    MAP      =  1
    LATLON   =  
    TITLE    =  1
    CLEAR    =  yes
    PANEL    =  0
    DEVICE   =  xw
    PROJ     =  sat
    FILTER   =  1
    TEXT     =  0.75/22//hw
    LUTFIL   =
    STNPLT   =
    CLRBAR   =
    LSTPRM   = 
</code></pre>

<p><code>COLORS</code>, <code>MAP</code>, <code>TITLE</code>, <code>FILTER</code> and <code>TEXT</code> control the graphic colors, line thickness,
style, text fonts and titles. These map aesthetics allow you to generate very specific graphics.  Check the parameter definition pages in the <a href=/gempak/manual/variables_index>manual</a> for more detail, or with the <code>phelp</code> command at the GEMPAK prompt.</p>

<p>After running <code>sfmap</code>, you can see how the colors match the surface parameters:</p>

<pre><code> Valid parameters:    SKYC TMPF WSYM SMSL BLNK DWPF STID BLNK BLNK BRBK
 Parameter colors:    26    2    7   25   20   22   18    0    0    6 
</code></pre>

<p><img src="example2.gif" alt="image" /></p>

<blockquote><p><img src=tip.gif width=40 align=left> <strong>Save your session!</strong> In the <code>sfmap</code> command prompt, you can save the current definitions with the command</p>

<pre><code>  GEMPAK-SFMAP&gt;save bob.nts
</code></pre>

<p>then exit the program and check that the file exists</p>

<pre><code>  GEMPAK-SFMAP&gt;e
  ls -la
  ...
  -rw-r--r--    1 gempak  staff      3151 Oct 29 14:38 bob.nts
</code></pre>

<p>You can reload this file in any other GEMPAK program, at any time, to retrieve the saved definitions, though only the variables which were saved in <code>sfmap</code> will be reloaded:</p>

<pre><code>  GEMPAK-SFMAP&gt; restore bob.nts
</code></pre></blockquote>

<p><a name="3.8"></a></p>

<h2>Exercise #3 (Live Data)</h2>

<p>Now let's look at data from today. Using an alias for real-time metar observations <code>SFFILE = metar</code>, and <code>DATTIM = 1200</code>, we can redisplay the map for this morning.</p>

<p>Make note of what the two new definitions are doing to retreive observations:</p>

<ol>
<li>The <code>SFFILE = metar</code> definition uses an <strong>alias</strong> to the latest GEMPAK metar surface file (typically <code>$GEMDATA/surface/YYYYMMDD_sao.gem</code>, where <code>YYYYMMDD</code> is the current year, month and day, such as <code>20121028</code>).</li>
<li><code>DATTIM = 1200</code> uses only the 1200 UTC records in <code>SFFILE</code></li>
</ol>


<p>But how to know the latest available? Exit <code>SFMAP</code> and return to the terminal, and execute the command line program <code>sfctime metar</code> and you will see surface reports in today's GEMPAK surface file for every twenty minutes:</p>

<pre><code>GEMPAK-SFMAP&gt;e
&gt; sfctime metar
...     
121028/1740     
121028/1800     
121028/1820     
121028/1840     
121028/1900 
&gt;
</code></pre>

<p>Inside our <code>sfmap</code> session, let's define a new <code>AREA</code>, <code>GAREA</code>, and <code>PROJ</code>:</p>

<pre><code> AREA     = us-
 GAREA    = us
 SFFILE   = metar
 DATTIM   = last
 SATFIL   = 
 CLEAR    = y
 PROJ     = STR/90;-100;0
 GEMPAK-SFMAP&gt;r 
</code></pre>

<p><img src="sfmap5.gif" alt="image" /></p>

<blockquote><p><img src=tip.gif width=40 align=left> <strong>Also note:</strong> the position of parameters in a list,</p>

<pre><code>  SFPARM   = skyc;tmpf;wsym;smsl;ptnd;dwpf;stid;;;brbk
              1    2    3    4    5    6   7       10
</code></pre>

<p>correspond to chart position:</p>

<pre><code>    18      14      8       16      22
    19      2       10      4       23
    12      3       1       5       13
    20      6       11      7       24
    21      15      9       17      25
</code></pre>

<p>which also corresponed to the standard ordering of data on a surface chart:</p>

<p><img src="standardchart.gif" alt="image" /></p></blockquote>

<p>To overlay the current GOES satellite visible image on your map, you must explicitly define <code>SATFIL</code>.  To find the latest EAST-CONUS visible satellite image,  list the contents of <code>$SAT/EAST-CONUS/1km/VIS/</code> with the command:</p>

<pre><code>ls $SAT/EAST-CONUS/1km/VIS/ | tail -1
VIS_20121029_2132
</code></pre>

<p>then use the entire path name for <code>SATFIL</code> (evironmental variables allowed):</p>

<pre><code>GAREA    = dset
PROJ     = sat
SATFIL   = $SAT/EAST-CONUS/1km/VIS/VIS_20121029_2132
DATTIM   = last
GEMPAK-SFMAP&gt;r 
</code></pre>

<p><img src=warning.gif width=30 align=left> <strong>Make Note</strong>:</p>

<ol>
<li>When using <code>SATFIL</code> or <code>RADFIL</code>, you must set <code>PROJ</code> either to <code>sat</code> or <code>rad</code>.</li>
<li>with <code>DATTIM = last</code>, there may not be any surface observations available in the <code>last</code> timeslot in the file referenced by <code>metar</code>.  If this is the case, explicitly define <code>DATTIM</code> using the a previous 20 minutes interval (i.e. <code>1140</code>, <code>1200</code>, <code>1220</code>).</li>
<li>This method of finding a recent satellite image to overlay is cumbersome! We will soon explore how shell scripting can manage the latest files and images for your GEMPAK programs with ease.</li>
<li><strong>Always</strong> run <code>gpend</code> after finishing a GEMPAK graphics program session.</li>
</ol>


<blockquote><p><a href=/gempak/tutorial/>GEMPAK Online Tutorial</a> | <a href="sounding_data_mapping.html">Next: Sounding Data Mapping</a></p></blockquote>
<script src="/gempak/add_in.js" type="text/javascript"></script>
</body>
</html>
