<html lang="en">
<head>
<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=AIzaSyA2G5dh6mBHu2SxKT5CELPj8wWwxdUWvro" type="text/javascript">
</script>
<script type="text/javascript" src="v2radar.js"></script>
<script type="text/javascript" src="v2ridge.js"></script>
<script type="text/javascript">

var Clock ;
var Cycle ;
var Google;
var Helper;
var Last=  0;
var Skew=  0;
var Wrap= 10;
var Idle=100;
var Back=500;
var Radar=[];
var Ridge=["FDR","FWS","TLX","INX","ICT","DDC","AMA","EAX","LZK","LSX","SGF"];
var Product="N0R";

function Pause(pause){
	Idle=pause*10;
	Back=pause*50;
}

function Opacity(opacity){
	for (var i=0;Ridge[i];i++){
		Radar[i].opacity(opacity);
	}
}

function Loop(){
	for (var i=0;Ridge[i];i++){
		Helper.childNodes[i].childNodes[0].data=Radar[i].select(Last);
	}
	Last=(Last+1)%Wrap;
	Clock=clearTimeout(Clock);
	Clock=setTimeout("Loop()",Last ? Idle : Back);
}

function Feed(){
	var stub="http://www.srh.noaa.gov/ridge2/JSON_generator.php?callback=CallBack&frames="+Wrap;
	for (var i=0;Ridge[i];i++){
		Radar[i].feed(stub+"&rid="+Ridge[i]+"&product="+Product);
	}
	Cycle=clearTimeout(Cycle);
	Cycle=setTimeout("Feed()",150000);
}

function CallBack(callback){
	var stub="http://www.srh.noaa.gov/";
	var pair;
	var reload=[];
        console.log(callback);
	for (var i=0;callback.directory[i];i++){
		pair=callback.directory[i].match(/([A-Z][A-Z][A-Z]|[A-Z][0-9][A-Z])/g);
		reload[i]=stub+callback.directory[i];
	}
	for (var i=0;Ridge[i];i++){
		if (pair) if (pair[0]==Product) if (pair[1]==Ridge[i]) Radar[i].reload(reload);
	}
}

function Load(){
	Google=document.getElementById("map_canvas");
	GDraggableObject.setDraggableCursor("pointer");
	GDraggableObject.setDraggingCursor ("pointer");
	Google=new GMap2(Google);
	Google.setCenter (new GLatLng(35.329,-97.274),7, G_PHYSICAL_MAP);
        Google.setUIToDefault();
	Helper=document.getElementById("helper");
	for (var i=0;Ridge[i];i++){
		Helper.appendChild(document.createElement("DIV"));
                Helper.childNodes[i].appendChild(document.createElement("a"));
		Radar[i]=new FrameAnimationLayerOverlay({bbox:BBox(Ridge[i],Product),size:{x:640,y:640},last:Last,skew:Skew,wrap:Wrap,name:Ridge[i]+"_"+Product});
		Google.addOverlay(Radar[i]);
	}
	Feed();
	Loop();

}

function Free(){
	GUnload();
}
</script></head>
<body onload="Load();" onunload="Free();">
<div style="font-family:arial; font-size:13px; font-weight:normal" align="center">
	<div id="map_canvas" style="width:800px;height: 600px;"></div>
	<div id="helper"></div>
	<div>
		<input type="radio" name="pause" onclick="Pause( 5);"> Extra Fast
		<input type="radio" name="pause" onclick="Pause( 8);"> Fast
		<input type="radio" name="pause" onclick="Pause(12);"> Medium
		<input type="radio" name="pause" onclick="Pause(18);"> Slow
		<input type="radio" name="pause" onclick="Pause(25);"> Extra Slow
		<input type="radio" name="pause" onclick="Pause( 2000);"> Pause
	</div>
	<div>Opacity
		<input type="radio" name="opacity" onclick="Opacity(0.25);">  25%
		<input type="radio" name="opacity" onclick="Opacity(0.50);">  50%
		<input type="radio" name="opacity" onclick="Opacity(0.75);">  75%
		<input type="radio" name="opacity" onclick="Opacity(1.00);"> 100%
</div>
</div>
</body>
</html>

